#ifndef BC_FORM_HEADER
#define BC_FORM_HEADER

#include <stdlib.h>
#include <stdio.h>
#include <assert.h>
#include <time.h>
#include <iostream>
#include <fstream>
#include <math.h>
#include <string>
#include <errno.h>
#include <sstream>
#include <vector>
#include <deque>
#include <algorithm>
#include <set>
#include <iomanip> // for precision

//#include <ilcplex/cplex.h>
#include <ilcplex/ilocplex.h>

#include <lemon/network_simplex.h>

#include "global_variables.h"
#include "global_functions.h"
#include "control_panel.h"


using namespace std;


typedef struct
{
    int id;
    int level;
    int br_var;
    int side;
//    int val;
//    int cur_LB;
//    int cur_UB
} BB_node_info;

typedef struct BB_node
{
    struct BB_node *father;

    BB_node_info info;

    double dual_bound;
    int primal_bound;
    int status;

    struct BB_node *left;
    struct BB_node *right;
} BB_node, *PTR_BB_node;


enum Task_status { EVALUATED, CALCULATING, WAITING };
enum Processor_status { PROC_FREE, PROC_COMPUTING, PROC_RETIRED };
enum LP_status { INFEASIBLE, INTEGER, FRACTIONAL, PRUNED, LP_ERROR };
enum node_sides { LEFT, RIGHT, ROOT };
enum cons_status { ADDED, NOTADDED };


/*************************************************************************************************/
void MPI_MyBCinit();
/*************************************************************************************************/

/*************************************************************************************************/
void MPI_MyBCfree();
/*************************************************************************************************/

/*************************************************************************************************/
bool myOperator (PTR_BB_node i_node, PTR_BB_node j_node);
/*************************************************************************************************/

/*************************************************************************************************/
bool myPairsOperator (pair<int,double> i_fracVar, pair<int,double> j_fracVar);
/*************************************************************************************************/

/*************************************************************************************************/
int my_floor(double a);
/*************************************************************************************************/

/*************************************************************************************************/
int my_ceil(double a);
/*************************************************************************************************/

/*************************************************************************************************/
void display_BB_node(int i_node);
/*************************************************************************************************/

/*************************************************************************************************/
bool branch_kHNDP_select_branching(IloNumArray const &solX, IloArray<IloNumArray> const &solF, int *item_i);
/*************************************************************************************************/

/*************************************************************************************************/
void branch_kHNDP_right(int item_i);
/*************************************************************************************************/

/*************************************************************************************************/
void branch_kHNDP_left(int item_i);
/*************************************************************************************************/

/*************************************************************************************************/
void branch_kHNDP_free(int item_i);
/*************************************************************************************************/

/*************************************************************************************************/
void add_children(int i_node, int i_var);
/*************************************************************************************************/

/*************************************************************************************************/
void master_flow_build();
/*************************************************************************************************/

/*************************************************************************************************/
void master_kHNDP_initialize();
/*************************************************************************************************/

/*************************************************************************************************/
double master_solve_lp();
/*************************************************************************************************/

/*************************************************************************************************/
bool master_check_integrality(IloNumArray const &solX, IloArray<IloNumArray> const &solF);
/*************************************************************************************************/

/*************************************************************************************************/
void master_display_status();
/*************************************************************************************************/

/*************************************************************************************************/
void master_kHNDP_free();
/*************************************************************************************************/

/*************************************************************************************************/
void master_kHNDP_Output();
/*************************************************************************************************/

/*************************************************************************************************/
int master_kHNDP_heur_solve(IloNumArray const &solX);
/*************************************************************************************************/

/*************************************************************************************************/
int branch_and_bound(int level);
/*************************************************************************************************/

/*************************************************************************************************/
int seperate_user_cuts(IloNumArray &solX, IloArray<IloNumArray> &solF);
/*************************************************************************************************/

/*************************************************************************************************/
int evaluate_node(int &primal_bound, int &i_item);
/*************************************************************************************************/

/*************************************************************************************************/
void master_affect_task();
/*************************************************************************************************/

/*************************************************************************************************/
void master_recieve_results();
/*************************************************************************************************/

/*************************************************************************************************/
void slave_return_results(int stat, double current_LB, int primal_bound, int i_item);
/*************************************************************************************************/

/*************************************************************************************************/
bool master_update_global_LB(PTR_BB_node _node);
/*************************************************************************************************/

/*************************************************************************************************/
void slave_recieve_task();
/*************************************************************************************************/

/*************************************************************************************************/
void slave_get_ready_for_solving();
/*************************************************************************************************/

/*************************************************************************************************/
void slave_restore_master_LP();
/*************************************************************************************************/

/*************************************************************************************************/
int manager_recieve_request(int &slave_id);
/*************************************************************************************************/

/*************************************************************************************************/
void manager_send_cons(int slave_id);
/*************************************************************************************************/

/*************************************************************************************************/
void slave_send_cons();
/*************************************************************************************************/

/*************************************************************************************************/
int manager_receive_cons(int slave_id);
/*************************************************************************************************/

/*************************************************************************************************/
void update_pool();
/*************************************************************************************************/

/*************************************************************************************************/
void add_cons(unsigned cons_i);
/*************************************************************************************************/

/*************************************************************************************************/
void update_lp();
/*************************************************************************************************/

/*************************************************************************************************/
void slave_receive_cons();
/*************************************************************************************************/

/*************************************************************************************************/
void master_close_manager();
/*************************************************************************************************/

/*************************************************************************************************/
void master();
/*************************************************************************************************/

/*************************************************************************************************/
void manager();
/*************************************************************************************************/

/*************************************************************************************************/
void slave();
/*************************************************************************************************/

#endif
